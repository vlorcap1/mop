<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Observatorio Regional del Maule</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#070b14;--bg2:#0d1321;--card:#121a2e;--card2:#182035;--border:#1e2d4a;--t1:#e4e9f2;--t2:#8b9bc0;--t3:#536080;--blue:#4d8eff;--cyan:#22d3ee;--green:#34d399;--amber:#fbbf24;--rose:#fb7185;--violet:#a78bfa;--grad1:linear-gradient(135deg,#4d8eff,#22d3ee);--grad2:linear-gradient(135deg,#34d399,#10b981);--grad3:linear-gradient(135deg,#fbbf24,#f59e0b);--grad4:linear-gradient(135deg,#a78bfa,#8b5cf6);--r:12px}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden}

/* HEADER */
.hdr{background:linear-gradient(180deg,rgba(77,142,255,.06),transparent);border-bottom:1px solid var(--border);padding:.85rem 2rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.hdr-l{display:flex;align-items:center;gap:1rem}
.logo{width:40px;height:40px;background:var(--grad1);border-radius:10px;display:grid;place-items:center;font-weight:700;font-size:.9rem;color:#fff;box-shadow:0 0 24px rgba(77,142,255,.25)}
.hdr h1{font-family:'Instrument Serif',serif;font-size:1.3rem;background:var(--grad1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hdr p{font-size:.66rem;color:var(--t3)}
.hdr-r{display:flex;align-items:center;gap:.5rem}

/* MAIN TABS */
.main-tabs{display:flex;gap:2px;background:var(--bg2);padding:4px 2rem;border-bottom:1px solid var(--border);position:sticky;top:55px;z-index:99;overflow-x:auto}
.mtab{padding:.55rem 1.1rem;font-size:.76rem;font-weight:500;border:none;background:none;color:var(--t3);cursor:pointer;font-family:inherit;transition:all .2s;white-space:nowrap;border-radius:8px 8px 0 0;position:relative}
.mtab:hover{color:var(--t1);background:rgba(77,142,255,.05)}
.mtab.act{color:#fff;background:rgba(77,142,255,.12)}
.mtab.act::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--grad1)}
.tbdg{font-size:.52rem;padding:1px 5px;border-radius:3px;font-weight:600}
.tbdg.lv{background:rgba(52,211,153,.15);color:var(--green)}
.tbdg.ex{background:rgba(77,142,255,.15);color:var(--blue)}

/* TAB CONTENT */
.tc{display:none}.tc.active{display:block}
.ifw{width:100%;height:calc(100vh - 110px);background:var(--bg2);position:relative}
.ifw iframe{width:100%;height:100%;border:none;background:#fff}
.ifld{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.8rem;color:var(--t2);font-size:.82rem;background:var(--bg2);z-index:2;transition:opacity .3s}
.ifld.hid{opacity:0;pointer-events:none}
.sp{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* MAIN */
.main{max-width:1400px;margin:0 auto;padding:1.4rem 2rem 3rem}
.slbl{font-size:.66rem;text-transform:uppercase;letter-spacing:2px;color:var(--t3);margin-bottom:.75rem;display:flex;align-items:center;gap:.5rem}
.slbl::after{content:'';flex:1;height:1px;background:var(--border)}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:.8rem;margin-bottom:1.4rem}
.kpi{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1rem 1.15rem;position:relative;overflow:hidden;transition:all .25s}
.kpi:hover{border-color:rgba(77,142,255,.3);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.35)}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.kpi:nth-child(1)::before{background:var(--grad1)}.kpi:nth-child(2)::before{background:var(--grad2)}.kpi:nth-child(3)::before{background:var(--grad3)}.kpi:nth-child(4)::before{background:var(--grad4)}.kpi:nth-child(5)::before{background:var(--grad1)}
.kl{font-size:.66rem;color:var(--t3);text-transform:uppercase;letter-spacing:.7px;margin-bottom:.3rem}
.kv{font-family:'Instrument Serif',serif;font-size:1.65rem;letter-spacing:-1px;line-height:1.1}
.kpi:nth-child(1) .kv{color:var(--blue)}.kpi:nth-child(2) .kv{color:var(--green)}.kpi:nth-child(3) .kv{color:var(--amber)}.kpi:nth-child(4) .kv{color:var(--violet)}.kpi:nth-child(5) .kv{color:var(--cyan)}
.kc{font-size:.68rem;margin-top:.2rem}.kc .pos{color:var(--green)}.kc .neg{color:var(--rose)}
.ks{font-size:.56rem;color:var(--t3);margin-top:.3rem;opacity:.6}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:.8rem}
.pnl{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1.15rem 1.2rem;transition:border-color .3s}
.pnl:hover{border-color:rgba(77,142,255,.15)}
.ph{display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem}
.pt{font-size:.82rem;font-weight:700}
.bdg{font-size:.56rem;padding:.18rem .42rem;border-radius:4px;font-weight:600}
.ba{background:rgba(77,142,255,.12);color:var(--blue)}.bi{background:rgba(52,211,153,.12);color:var(--green)}.bb{background:rgba(167,139,250,.12);color:var(--violet)}.bl{background:rgba(251,191,36,.12);color:var(--amber)}

#dgaMap{height:480px;width:100%;border-radius:10px;z-index:1}
#dgaOrgMap{height:480px;width:100%;border-radius:10px;z-index:1}
.leaflet-popup-content-wrapper{background:var(--card)!important;color:var(--t1)!important;border:1px solid var(--border)!important;border-radius:10px!important;box-shadow:0 8px 32px rgba(0,0,0,.5)!important}
.leaflet-popup-tip{background:var(--card)!important}
.leaflet-popup-content{font-family:'DM Sans',sans-serif!important;font-size:.75rem!important;line-height:1.5!important}
.leaflet-popup-content b{color:var(--blue)}
.leaflet-popup-content .pop-tipo{display:inline-block;font-size:.6rem;padding:1px 6px;border-radius:3px;font-weight:600;margin-top:3px}
.map-legend{position:absolute;bottom:24px;right:12px;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:.55rem .7rem;z-index:1000;font-size:.65rem;color:var(--t2);line-height:1.6}
.map-legend i{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:5px;vertical-align:middle}
.map-filters{display:flex;gap:.3rem;flex-wrap:wrap;margin-bottom:.6rem}
.map-filters button{padding:.25rem .55rem;font-size:.64rem;border-radius:5px;border:1px solid var(--border);background:var(--bg2);color:var(--t2);cursor:pointer;font-family:inherit;transition:all .2s}
.map-filters button.mf-act{border-color:var(--blue);background:rgba(77,142,255,.15);color:var(--blue)}
.map-filters button:hover{border-color:var(--blue)}
.leaflet-container{background:var(--bg2)!important}
.marker-cluster-small,.marker-cluster-medium,.marker-cluster-large{background:rgba(77,142,255,.25)!important}
.marker-cluster-small div,.marker-cluster-medium div,.marker-cluster-large div{background:rgba(77,142,255,.7)!important;color:#fff!important;font-family:'DM Sans',sans-serif!important;font-weight:600!important;font-size:.7rem!important}
.br{display:flex;align-items:center;gap:.6rem;margin-bottom:.45rem}
.brl{min-width:90px;font-size:.71rem;color:var(--t2);text-align:right}
.brt{flex:1;height:20px;background:rgba(77,142,255,.05);border-radius:4px;overflow:hidden}
.brf{height:100%;border-radius:4px;display:flex;align-items:center;padding-left:7px;font-size:.62rem;font-weight:600;color:#fff;transition:width 1.2s ease}
.brf.b1{background:var(--grad1)}.brf.b2{background:var(--grad2)}.brf.b3{background:var(--grad3)}.brf.b4{background:var(--grad4)}
.cg{display:grid;grid-template-columns:repeat(5,1fr);gap:.32rem}
.ci{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:.42rem .5rem;font-size:.64rem;color:var(--t2);text-align:center}.ci:hover{border-color:var(--blue);color:var(--t1)}
.cv{font-weight:700;color:var(--t1);margin-top:2px;font-size:.7rem}
.tbl{width:100%;border-collapse:collapse;font-size:.74rem}
.tbl th{text-align:left;padding:.48rem .55rem;color:var(--t3);font-weight:500;font-size:.64rem;text-transform:uppercase;border-bottom:1px solid var(--border)}
.tbl td{padding:.48rem .55rem;border-bottom:1px solid rgba(30,45,74,.4);color:var(--t2)}
.tbl .v{color:var(--t1);font-weight:600}.tbl .pos{color:var(--green)}.tbl .neg{color:var(--rose)}
.ftr{text-align:center;padding:1.2rem;color:var(--t3);font-size:.6rem;border-top:1px solid var(--border)}.ftr a{color:var(--blue);text-decoration:none}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}.anim{animation:fadeUp .4s ease forwards;opacity:0}
@media(max-width:1100px){.kpis{grid-template-columns:repeat(3,1fr)}.g2{grid-template-columns:1fr}.cg{grid-template-columns:repeat(3,1fr)}}
@media(max-width:600px){.kpis{grid-template-columns:1fr}.hdr{flex-direction:column;gap:.6rem;align-items:flex-start}.main{padding:1rem}.cg{grid-template-columns:repeat(2,1fr)}.main-tabs{padding:4px .5rem}}
</style>
</head>
<body>

<header class="hdr">
  <div class="hdr-l"><div class="logo">VII</div><div><h1>Observatorio Regi√≥n del Maule</h1><p>Proyectos regionales ¬∑ Datos en vivo</p></div></div>
</header>

<nav class="main-tabs">
  <button class="mtab act" onclick="sw('mop',this)">üèóÔ∏è Proyectos MOP <span class="tbdg ex">EXT</span></button>
  <button class="mtab" onclick="sw('dga',this)">üíß DGA Estaciones <span class="tbdg lv">361</span></button>
  <button class="mtab" onclick="sw('dga-org',this)">üèõÔ∏è DGA Organizaciones <span class="tbdg lv">612</span></button>
  <button class="mtab" onclick="sw('powerbi',this)">üìä Power BI <span class="tbdg ex">EXT</span></button>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê MOP ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc active" id="t-mop"><div class="ifw"><div class="ifld" id="ld-mop"><div class="sp"></div>Cargando Proyectos MOP Maule...</div></div></div>

<!-- ‚ïê‚ïê‚ïê‚ïê DGA ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc" id="t-dga">
<main class="main">
<div class="slbl">Estaciones DGA ‚Äî Direcci√≥n General de Aguas, Regi√≥n del Maule</div>
<div class="kpis" style="grid-template-columns:repeat(5,1fr)">
  <div class="kpi"><div class="kl">üíß Total Estaciones</div><div class="kv" style="color:var(--blue)">361</div><div class="kc"><span class="pos">Regi√≥n del Maule</span></div><div class="ks">DGA - Maule</div></div>
  <div class="kpi"><div class="kl">üî¨ Calidad de Agua</div><div class="kv" style="color:var(--green)">199</div><div class="kc"><span class="pos">55% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi"><div class="kl">üåä Fluviom√©tricas</div><div class="kv" style="color:var(--amber)">83</div><div class="kc"><span class="pos">23% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi"><div class="kl">üå§Ô∏è Meteorol√≥gicas</div><div class="kv" style="color:var(--violet)">50</div><div class="kc"><span class="pos">14% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi"><div class="kl">üìç Comunas</div><div class="kv" style="color:var(--cyan)">30</div><div class="kc"><span class="pos">4 provincias</span></div><div class="ks">DGA</div></div>
</div>
<div class="slbl">Distribuci√≥n por Tipo y Cuenca</div>
<div class="g2">
  <div class="pnl"><div class="ph"><span class="pt">Estaciones por Tipo</span><span class="bdg ba">DGA</span></div><div class="br"><span class="brl">Calidad De Agua</span><div class="brt"><div class="brf b1" style="width:100%">199</div></div></div>
<div class="br"><span class="brl">Fluviometrica</span><div class="brt"><div class="brf b2" style="width:42%">83</div></div></div>
<div class="br"><span class="brl">Meteorologica</span><div class="brt"><div class="brf b3" style="width:25%">50</div></div></div>
<div class="br"><span class="brl">Control De Nivel</span><div class="brt"><div class="brf b4" style="width:9%">18</div></div></div>
<div class="br"><span class="brl">Lagos Y Embalses</span><div class="brt"><div class="brf b1" style="width:4%">7</div></div></div>
<div class="br"><span class="brl">Ruta De Nieve</span><div class="brt"><div class="brf b2" style="width:2%">4</div></div></div>
</div>
  <div class="pnl"><div class="ph"><span class="pt">Estaciones por Cuenca</span><span class="bdg bi">DGA</span></div><div class="br"><span class="brl" style="min-width:140px">Rio Maule</span><div class="brt"><div class="brf b1" style="width:100%">233</div></div></div>
<div class="br"><span class="brl" style="min-width:140px">Rio Mataquito</span><div class="brt"><div class="brf b2" style="width:34%">82</div></div></div>
<div class="br"><span class="brl" style="min-width:140px">Rio Mataquito</span><div class="brt"><div class="brf b3" style="width:6%">15</div></div></div>
<div class="br"><span class="brl" style="min-width:140px">Mataquito-Maule</span><div class="brt"><div class="brf b4" style="width:4%">10</div></div></div>
<div class="br"><span class="brl" style="min-width:140px">Maule-Limite Octava R.</span><div class="brt"><div class="brf b1" style="width:4%">10</div></div></div>
</div>
</div>

<div class="slbl">Mapa de Estaciones DGA ‚Äî Regi√≥n del Maule</div>
<div class="pnl" style="position:relative;overflow:visible">
  <div class="ph"><span class="pt">361 Estaciones de Monitoreo</span><span class="bdg ba">DGA ¬∑ Leaflet</span></div>
  <div class="map-filters" id="mapFilters">
    <button class="mf-act" onclick="filterMap('ALL',this)">Todas (361)</button>
    <button onclick="filterMap('CALIDAD DE AGUA',this)">üî¨ Calidad Agua</button>
    <button onclick="filterMap('FLUVIOMETRICA',this)">üåä Fluviom√©trica</button>
    <button onclick="filterMap('METEOROLOGICA',this)">üå§Ô∏è Meteorol√≥gica</button>
    <button onclick="filterMap('CONTROL DE NIVEL',this)">üìè Control Nivel</button>
    <button onclick="filterMap('LAGOS Y EMBALSES',this)">üèûÔ∏è Lagos</button>
  </div>
  <div id="dgaMap"></div>
  <div class="map-legend">
    <div><i style="background:#4d8eff"></i>Calidad de Agua</div>
    <div><i style="background:#34d399"></i>Fluviom√©trica</div>
    <div><i style="background:#fbbf24"></i>Meteorol√≥gica</div>
    <div><i style="background:#a78bfa"></i>Control de Nivel</div>
    <div><i style="background:#22d3ee"></i>Lagos y Embalses</div>
    <div><i style="background:#fb7185"></i>Otros</div>
  </div>
</div>

<div class="g2">
  <div class="pnl"><div class="ph"><span class="pt">Top Comunas con m√°s Estaciones</span><span class="bdg bi">DGA</span></div><div class="cg" style="grid-template-columns:repeat(4,1fr)"><div class="ci"><div>San Clemente</div><div class="cv">34</div></div>
<div class="ci"><div>Linares</div><div class="cv">28</div></div>
<div class="ci"><div>Curico</div><div class="cv">26</div></div>
<div class="ci"><div>Parral</div><div class="cv">19</div></div>
<div class="ci"><div>Vichuquen</div><div class="cv">16</div></div>
<div class="ci"><div>Cauquenes</div><div class="cv">15</div></div>
<div class="ci"><div>Teno</div><div class="cv">14</div></div>
<div class="ci"><div>Colbun</div><div class="cv">14</div></div>
<div class="ci"><div>Longavi</div><div class="cv">13</div></div>
<div class="ci"><div>San Javier</div><div class="cv">13</div></div>
<div class="ci"><div>Talca</div><div class="cv">13</div></div>
<div class="ci"><div>Rio Claro</div><div class="cv">13</div></div>
</div></div>
</div>
<div class="slbl">Listado de Estaciones (100 de 361)</div>
<div class="pnl" style="overflow-x:auto">
  <div style="margin-bottom:.6rem;display:flex;gap:.4rem;align-items:center">
    <input type="text" id="dgaSearch" placeholder="Buscar estaci√≥n, comuna, cuenca..." oninput="filterDGA()" style="background:var(--bg2);border:1px solid var(--border);color:var(--t1);padding:.4rem .6rem;border-radius:6px;font-size:.72rem;font-family:inherit;flex:1;max-width:400px">
    <span style="font-size:.65rem;color:var(--t3)" id="dgaCount">Mostrando 100 de 361</span>
  </div>
  <table class="tbl" id="dgaTable">
    <thead><tr><th>C√≥digo</th><th>Estaci√≥n</th><th>Provincia</th><th>Comuna</th><th>Tipo</th><th>Cuenca</th><th>Alt.</th></tr></thead>
    <tbody><tr><td class="v">07000006</td><td>LAGO VICHUQUEN ESTERO LLICO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000007</td><td>LAGO VICHUQUEN SECTOR BAHIA VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000008</td><td>LAGO VICHUQUEN EN ESTERO VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000009</td><td>LAGO VICHUQUEN EN SECTOR CENTRO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000010</td><td>LAGUNA TORCA SECTOR CENTRO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000011</td><td>LAGO VICHUQUEN Z MAX</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000012</td><td>POZO SECTOR VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>19</td></tr>
<tr><td class="v">07000013</td><td>LAGO TILICURA - Z MAX</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000014</td><td>LAGO TILICURA - PUNTO LAGUNA 1</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000015</td><td>LAGO TILICURA - PUNTO LAGUNA 2</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000016</td><td>APR DUAO-LIPIMAVIDA</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000017</td><td>APR LLICO</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000018</td><td>APR VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>-</td></tr>
<tr><td class="v">07000019</td><td>POZO VICHUQUEN</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg bl">CONTROL DE NIVEL</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>195</td></tr>
<tr><td class="v">07000020</td><td>ESTERO LLICO EN EL PUENTE</td><td>CURICO</td><td>VICHUQUEN</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>COSTERAS LIMITE SEPTIMA R.-RIO</td><td>7</td></tr>
<tr><td class="v">07100006</td><td>PASO VERGARA</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bl">RUTA DE NIEVE</span></td><td>RIO MATAQUITO</td><td>2602</td></tr>
<tr><td class="v">07100007</td><td>RIO MALO ANTES JUNTA RIO TENO</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bi">FLUVIOMETRICA</span></td><td>RIO MATAQUITO</td><td>1568</td></tr>
<tr><td class="v">07100008</td><td>EMBALSE EL PLANCHON (LM)</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg bb">METEOROLOGICA</span></td><td>RIO MATAQUITO</td><td>2500</td></tr>
<tr><td class="v">07101001</td><td>RIO TENO ANTES RIO INFIERNILLO (CA)</td><td>CURICO</td><td>ROMERAL</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>1100</td></tr>
<tr><td class="v">07102001</td><td>RIO TENO EN LOS QUE√ëES</td><td>CURICO</td><td>TENO</td><td><span class="bdg ba">CALIDAD DE AGUA</span></td><td>RIO MATAQUITO</td><td>900</td></tr>
<!-- M√°s filas... (total 100) -->
</tbody>
  </table>
</div>
</main>
<footer class="ftr">Fuente: Informe Nacional DGA ‚Äî MOP ¬∑ Direcci√≥n General de Aguas ¬∑ Regi√≥n del Maule (361 estaciones)</footer>
</div>


<!-- ‚ïê‚ïê‚ïê‚ïê DGA ORGANIZACIONES ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc" id="t-dga-org">
<main class="main">
<div class="slbl anim">Organizaciones de Usuarios de Aguas ‚Äî Regi√≥n del Maule</div>
<div class="kpis">
  <div class="kpi anim" style="animation-delay:.04s"><div class="kl">üåä Com. Superficiales</div><div class="kv" style="color:var(--blue)">570</div><div class="kc"><span class="pos">91.6% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi anim" style="animation-delay:.08s"><div class="kl">üöú Asoc. Canalistas</div><div class="kv" style="color:var(--green)">34</div><div class="kc"><span class="pos">5.5% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi anim" style="animation-delay:.12s"><div class="kl">‚öñÔ∏è Juntas Vigilancia</div><div class="kv" style="color:var(--violet)">8</div><div class="kc"><span class="pos">1.3% del total</span></div><div class="ks">DGA</div></div>
  <div class="kpi anim" style="animation-delay:.16s"><div class="kl">üìç Total Organizaciones</div><div class="kv" style="color:var(--cyan)">612</div><div class="kc"><span class="pos">Regi√≥n del Maule</span></div><div class="ks">DGA</div></div>
  <div class="kpi anim" style="animation-delay:.2s"><div class="kl">üèòÔ∏è Comunas</div><div class="kv" style="color:var(--amber)">30</div><div class="kc"><span class="pos">4 provincias</span></div><div class="ks">DGA</div></div>
</div>

<div class="slbl anim" style="animation-delay:.22s">Mapa Interactivo</div>
<div class="pnl anim" style="position:relative;overflow:visible;animation-delay:.24s">
  <div class="ph"><span class="pt">612 Organizaciones de Usuarios de Aguas</span><span class="bdg ba">DGA ¬∑ Leaflet</span></div>
  <div class="map-filters" id="mapOrgFilters">
    <button class="mf-act" onclick="filterOrgMap('ALL',this)">Todas (612)</button>
    <button onclick="filterOrgMap('Comunidad de Aguas Superficiales',this)">üåä Com. Superficiales</button>
    <button onclick="filterOrgMap('Asociaci√≥n de Canalistas',this)">üöú Asoc. Canalistas</button>
    <button onclick="filterOrgMap('Junta de Vigilancia',this)">‚öñÔ∏è Juntas Vigilancia</button>
  </div>
  <div id="dgaOrgMap"></div>
  <div class="map-legend">
    <div><i style="background:#4d8eff"></i>Com. Superficiales</div>
    <div><i style="background:#34d399"></i>Asoc. Canalistas</div>
    <div><i style="background:#a78bfa"></i>Juntas Vigilancia</div>
  </div>
</div>

<div class="slbl anim" style="animation-delay:.26s">Distribuci√≥n</div>
<div class="g2 anim" style="animation-delay:.28s">
  <div class="pnl"><div class="ph"><span class="pt">Por Provincia</span><span class="bdg bb">DGA</span></div>
    <div class="br"><span class="brl" style="min-width:140px">Linares</span><div class="brt"><div class="brf b1" style="width:100%">222</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Talca</span><div class="brt"><div class="brf b2" style="width:93%">207</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Curic√≥</span><div class="brt"><div class="brf b3" style="width:73%">162</div></div></div>
    <div class="br"><span class="brl" style="min-width:140px">Cauquenes</span><div class="brt"><div class="brf b4" style="width:5%">10</div></div></div>
  </div>
  <div class="pnl"><div class="ph"><span class="pt">Por Tipo</span><span class="bdg bi">DGA</span></div>
    <div class="br"><span class="brl" style="min-width:180px">Com. Superficiales</span><div class="brt"><div class="brf b1" style="width:100%">570</div></div></div>
    <div class="br"><span class="brl" style="min-width:180px">Asoc. Canalistas</span><div class="brt"><div class="brf b2" style="width:6%">34</div></div></div>
    <div class="br"><span class="brl" style="min-width:180px">Juntas Vigilancia</span><div class="brt"><div class="brf b3" style="width:1.4%">8</div></div></div>
  </div>
</div>
</main>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê POWER BI ‚ïê‚ïê‚ïê‚ïê -->
<div class="tc" id="t-powerbi"><div class="ifw"><div class="ifld" id="ld-powerbi"><div class="sp"></div>Cargando Power BI...</div></div></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS + LAZY IFRAME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const IURLS = {
  mop: 'https://vlorcap1.github.io/mop_prueba_2/',
  powerbi: 'https://app.powerbi.com/view?r=eyJrIjoiOGNhOGEwZDQtMjQ1NC00YmY3LWI3MzYtYWYyNzJlNTMzMjljIiwidCI6ImU3ZDU1MzE2LTQ5M2EtNGRiMi05NzRjLWUwODllZjZjMGZkZSJ9&pageName=d2cff37972c7f96b2245'
};
const iLoaded = {};

function sw(id, btn) {
  document.querySelectorAll('.mtab').forEach(t => t.classList.remove('act'));
  document.querySelectorAll('.tc').forEach(t => t.classList.remove('active'));
  btn.classList.add('act');
  document.getElementById('t-' + id).classList.add('active');
  if (id === 'dga') { setTimeout(function(){ initDGAMap(); if(dgaMap) dgaMap.invalidateSize(); }, 100); }
  if (id === 'dga-org') { setTimeout(function(){ initDGAOrgMap(); if(dgaOrgMap) dgaOrgMap.invalidateSize(); }, 150); }
  if (IURLS[id] && !iLoaded[id]) {
    iLoaded[id] = true;
    const wrap = document.querySelector('#t-' + id + ' .ifw');
    const ld = document.getElementById('ld-' + id);
    const ifr = document.createElement('iframe');
    ifr.src = IURLS[id];
    ifr.onload = function () {
      if (ld) ld.classList.add('hid');
    };
    ifr.onerror = function () {
      if (ld) ld.innerHTML = '<div style="color:var(--rose)">‚ö†Ô∏è Error al cargar</div><a href="' + IURLS[id] + '" target="_blank" style="color:var(--blue);font-size:.8rem;margin-top:.5rem">Abrir en nueva ventana</a>';
    };
    wrap.appendChild(ifr);
  }
}

/* DGA search filter */
function filterDGA() {
  var q = document.getElementById('dgaSearch').value.toLowerCase();
  var rows = document.querySelectorAll('#dgaTable tbody tr');
  var shown = 0;
  rows.forEach(function(r) {
    var txt = r.textContent.toLowerCase();
    var match = !q || txt.indexOf(q) >= 0;
    r.style.display = match ? '' : 'none';
    if (match) shown++;
  });
  document.getElementById('dgaCount').textContent = 'Mostrando ' + shown + ' de 361';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DGA MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
var DGA_STATIONS = [{"lat": -34.82917, "lon": -72.06778, "nom": "LAGO VICHUQUEN ESTERO LLICO", "tipo": "CALIDAD DE AGUA", "com": "VICHUQUEN", "cuenca": "COSTERAS LIMITE SEPTIMA R.-RIO MATA", "cod": "07000006"}/* ... resto de estaciones ... */];
var DGA_ORGANIZATIONS = [{"lat":-35.44005566932599,"lon":-71.65285658944133,"nom":"ASTUDILLANO","tipo":"Comunidad de Aguas Superficiales","com":"LINARES","provincia":"LINARES"}/* ... resto de organizaciones ... */];

var dgaMap = null;
var dgaOrgMap = null;
var dgaMarkers = null;
var dgaOrgMarkers = null;
var dgaAllLayers = [];
var dgaOrgAllLayers = [];

var TIPO_COLORS = {
  'CALIDAD DE AGUA': '#4d8eff',
  'FLUVIOMETRICA': '#34d399',
  'METEOROLOGICA': '#fbbf24',
  'CONTROL DE NIVEL': '#a78bfa',
  'LAGOS Y EMBALSES': '#22d3ee',
  'RUTA DE NIEVE': '#818cf8',
  'SEDIMENTOMETRICA': '#f97316',
  'NIEVES Y GLACIARES': '#818cf8'
};

var TIPO_COLORS_ORG = {
  'Comunidad de Aguas Superficiales': '#4d8eff',
  'Asociaci√≥n de Canalistas': '#34d399',
  'Junta de Vigilancia': '#a78bfa'
};

function initDGAMap() {
  if (dgaMap) return;
  dgaMap = L.map('dgaMap', { zoomControl: true }).setView([-35.5, -71.3], 8);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://carto.com/">CARTO</a> &copy; <a href="https://osm.org/">OSM</a>',
    subdomains: 'abcd', maxZoom: 18
  }).addTo(dgaMap);
  
  dgaMarkers = L.markerClusterGroup({
    maxClusterRadius: 40,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    iconCreateFunction: function(cluster) {
      var count = cluster.getChildCount();
      var size = count < 10 ? 'small' : count < 50 ? 'medium' : 'large';
      return L.divIcon({ html: '<div>' + count + '</div>', className: 'marker-cluster marker-cluster-' + size, iconSize: L.point(36, 36) });
    }
  });

  DGA_STATIONS.forEach(function(s) {
    var col = TIPO_COLORS[s.tipo] || '#fb7185';
    var icon = L.divIcon({
      className: '',
      html: '<div style="width:10px;height:10px;border-radius:50%;background:' + col + ';border:2px solid #fff;box-shadow:0 0 6px ' + col + '80"></div>',
      iconSize: [10, 10], iconAnchor: [5, 5]
    });
    var popup = '<b>' + s.nom + '</b><br>C√≥digo: ' + s.cod + '<br>Comuna: ' + s.com + '<br>Cuenca: ' + s.cuenca + '<br><span class="pop-tipo" style="background:' + col + '30;color:' + col + '">' + s.tipo + '</span>';
    var marker = L.marker([s.lat, s.lon], { icon: icon }).bindPopup(popup);
    marker._dgaTipo = s.tipo;
    dgaAllLayers.push(marker);
    dgaMarkers.addLayer(marker);
  });
  dgaMap.addLayer(dgaMarkers);
}

function filterMap(tipo, btn) {
  document.querySelectorAll('#mapFilters button').forEach(function(b) { b.classList.remove('mf-act'); });
  btn.classList.add('mf-act');
  dgaMarkers.clearLayers();
  dgaAllLayers.forEach(function(m) {
    if (tipo === 'ALL' || m._dgaTipo === tipo) dgaMarkers.addLayer(m);
  });
}

function initDGAOrgMap() {
  if (dgaOrgMap) { 
    dgaOrgMap.invalidateSize(); 
    return; 
  }
  
  dgaOrgMap = L.map('dgaOrgMap', { zoomControl: true }).setView([-35.5, -71.5], 9);
  
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; CARTO',
    subdomains: 'abcd',
    maxZoom: 18
  }).addTo(dgaOrgMap);
  
  dgaOrgMarkers = L.markerClusterGroup({
    maxClusterRadius: 50,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    iconCreateFunction: function(cluster) {
      var c = cluster.getChildCount();
      var s = c < 10 ? 'small' : c < 50 ? 'medium' : 'large';
      return L.divIcon({ html: '<div>' + c + '</div>', className: 'marker-cluster marker-cluster-' + s, iconSize: L.point(36, 36) });
    }
  });

  DGA_ORGANIZATIONS.forEach(function(s) {
    var col = TIPO_COLORS_ORG[s.tipo] || '#fb7185';
    var icon = L.divIcon({
      className: '',
      html: '<div style="width:12px;height:12px;border-radius:50%;background:' + col + ';border:2px solid #fff;box-shadow:0 0 8px ' + col + '90"></div>',
      iconSize: [12, 12],
      iconAnchor: [6, 6]
    });
    var info = '<b>' + s.nom + '</b><br><span style="background:' + col + '30;color:' + col + ';padding:2px 6px;border-radius:3px;font-size:.65rem">' + s.tipo + '</span>';
    if (s.com) info += '<br>Comuna: ' + s.com;
    if (s.provincia) info += '<br>Provincia: ' + s.provincia;
    var marker = L.marker([s.lat, s.lon], { icon: icon }).bindPopup(info);
    marker._orgTipo = s.tipo;
    dgaOrgAllLayers.push(marker);
    dgaOrgMarkers.addLayer(marker);
  });
  
  dgaOrgMap.addLayer(dgaOrgMarkers);
  
  setTimeout(function(){ 
    dgaOrgMap.invalidateSize(); 
  }, 200);
}

function filterOrgMap(tipo, btn) {
  if (!dgaOrgMarkers) return;
  document.querySelectorAll('#mapOrgFilters button').forEach(function(b) { b.classList.remove('mf-act'); });
  btn.classList.add('mf-act');
  dgaOrgMarkers.clearLayers();
  dgaOrgAllLayers.forEach(function(m) {
    if (tipo === 'ALL' || m._orgTipo === tipo) dgaOrgMarkers.addLayer(m);
  });
}

// Init on load
window.addEventListener('load', function() {
  // Primera pesta√±a activa por defecto (MOP)
});
</script>
</body>
</html>
